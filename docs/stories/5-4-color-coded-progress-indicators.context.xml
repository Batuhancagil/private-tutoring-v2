<story-context id="bmad/bmm/workflows/4-implementation/story-context" v="1.0">
  <metadata>
    <epicId>5</epicId>
    <storyId>5-4</storyId>
    <title>Color-Coded Progress Indicators</title>
    <status>drafted</status>
    <generatedAt>2025-11-25</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/5-4-color-coded-progress-indicators.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>system</asA>
    <iWant>to display color-coded progress indicators</iWant>
    <soThat>teachers can instantly see student status</soThat>
    <tasks>
      <task>Create ProgressIndicator component (components/teacher/ProgressIndicator.tsx)</task>
      <task>Implement color coding logic: Green (≥ threshold), Yellow (threshold-5% to threshold), Red (&lt; threshold-5%)</task>
      <task>Create getProgressColor() utility function in lib/progress-helpers.ts</task>
      <task>Add accessibility features: aria-labels, text alternatives, WCAG AA compliance</task>
      <task>Integrate progress indicators with existing progress displays (topic, lesson, dual metrics)</task>
      <task>Add threshold configuration support (default 70% for MVP)</task>
      <task>Unit tests for getProgressColor() function</task>
      <task>Component tests for ProgressIndicator component</task>
      <task>Accessibility tests for color contrast and text alternatives</task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="AC1">
      <given>progress is calculated</given>
      <when>indicators are displayed</when>
      <then>colors represent: Green (accuracy ≥ threshold), Yellow (near threshold), Red (accuracy &lt; threshold - 5%)</then>
      <and>colors have text alternatives (accessibility)</and>
      <and>threshold is customizable (default 70%)</and>
    </criterion>
    <criterion id="AC2">
      <given>a student's accuracy is calculated</given>
      <when>accuracy is ≥ threshold (default 70%)</when>
      <then>indicator displays green color</then>
      <and>text alternative indicates "On track" or similar</and>
    </criterion>
    <criterion id="AC3">
      <given>a student's accuracy is calculated</given>
      <when>accuracy is between (threshold - 5%) and threshold</when>
      <then>indicator displays yellow color</then>
      <and>text alternative indicates "Attention needed" or similar</and>
    </criterion>
    <criterion id="AC4">
      <given>a student's accuracy is calculated</given>
      <when>accuracy is &lt; (threshold - 5%)</when>
      <then>indicator displays red color</then>
      <and>text alternative indicates "Struggling" or similar</and>
    </criterion>
    <criterion id="AC5">
      <given>progress indicators are displayed</given>
      <when>viewed by a user with color vision deficiency</when>
      <then>text alternatives are clearly visible</then>
      <and>indicators meet WCAG accessibility standards</and>
    </criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/stories/tech-spec-epic-5.md</path>
        <title>Epic 5 Technical Specification</title>
        <section>Color-Coded Progress Indicators</section>
        <snippet>Display visual status indicators (green = on track ≥ threshold, yellow = attention needed, red = struggling &lt; threshold) with text alternatives for accessibility. Threshold customizable (default 70%).</snippet>
      </doc>
      <doc>
        <path>docs/epics.md</path>
        <title>Epic Breakdown</title>
        <section>Epic 5: Progress Calculation &amp; Visualization - Story 5.4</section>
        <snippet>As a system, I want to display color-coded progress indicators, So that teachers can instantly see student status. Colors: Green (on track), Yellow (attention needed), Red (struggling).</snippet>
      </doc>
      <doc>
        <path>docs/PRD.md</path>
        <title>Product Requirements Document</title>
        <section>FR-006: Progress Calculation &amp; Visualization</section>
        <snippet>FR-006.4: The system shall display color-coded progress indicators for instant status visibility. Colors must have text alternatives for accessibility.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture Document</title>
        <section>Accessibility</section>
        <snippet>All UI components must meet WCAG AA standards. Color indicators must have text alternatives. Use aria-labels and proper semantic HTML.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>components/teacher/ResourcesPageClient.tsx</path>
        <kind>component</kind>
        <symbol>ResourcesPageClient</symbol>
        <lines>1-334</lines>
        <reason>Example component pattern to follow: uses TypeScript, Tailwind CSS, proper prop types, loading/error states.</reason>
      </artifact>
      <artifact>
        <path>components/ui/Card.tsx</path>
        <kind>component</kind>
        <symbol>Card, CardHeader, CardTitle, CardContent</symbol>
        <lines>1-50</lines>
        <reason>Existing UI components to use for consistent styling. ProgressIndicator can use Card component for container.</reason>
      </artifact>
      <artifact>
        <path>lib/progress-calculator.ts</path>
        <kind>service</kind>
        <symbol>calculateTopicProgress, calculateLessonProgress, calculateDualMetrics</symbol>
        <lines>1-200</lines>
        <reason>Progress calculation services that provide accuracy values. ProgressIndicator will consume these accuracy values for color coding.</reason>
      </artifact>
      <artifact>
        <path>tailwind.config.ts</path>
        <kind>config</kind>
        <symbol>colors</symbol>
        <lines>1-50</lines>
        <reason>Tailwind CSS configuration with color system. Use Tailwind color classes for green, yellow, red indicators.</reason>
      </artifact>
    </code>
    <dependencies>
      <ecosystem name="node">
        <package name="next" version="^14.2.0" />
        <package name="react" version="^18.3.0" />
        <package name="react-dom" version="^18.3.0" />
        <package name="typescript" version="^5.5.0" />
        <package name="tailwindcss" version="^3.4.0" />
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>Accessibility: Must meet WCAG AA standards for color contrast (4.5:1 for text) and text alternatives</constraint>
    <constraint>Color coding logic: Green = accuracy ≥ threshold, Yellow = threshold - 5% ≤ accuracy &lt; threshold, Red = accuracy &lt; threshold - 5%</constraint>
    <constraint>Threshold configuration: Default 70% for MVP, customization UI deferred to Epic 6</constraint>
    <constraint>Text alternatives: All color indicators must have aria-labels with status text and accuracy percentage</constraint>
    <constraint>Design system: Use Tailwind CSS color classes, ensure consistency with existing design system</constraint>
    <constraint>Component pattern: Follow existing component patterns from components/teacher/ - use TypeScript, Tailwind CSS, proper prop types</constraint>
    <constraint>Integration: Progress indicators must integrate with existing progress displays (topic, lesson, dual metrics)</constraint>
    <constraint>Real-time updates: Indicators will update automatically when progress recalculates (from Epic 5 stories)</constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>ProgressIndicator Component</name>
      <kind>React component</kind>
      <signature>interface ProgressIndicatorProps {
  accuracy: number; // 0-100 percentage
  threshold?: number; // Default 70
  className?: string;
}

export function ProgressIndicator({ accuracy, threshold = 70, className }: ProgressIndicatorProps): JSX.Element</signature>
      <path>components/teacher/ProgressIndicator.tsx</path>
    </interface>
    <interface>
      <name>getProgressColor()</name>
      <kind>function</kind>
      <signature>function getProgressColor(accuracy: number, threshold: number): { color: 'green' | 'yellow' | 'red', status: string }
Input: accuracy (number 0-100), threshold (number, default 70)
Output: { color: 'green' | 'yellow' | 'red', status: string }
Returns color and status text for accessibility</signature>
      <path>lib/progress-helpers.ts</path>
    </interface>
  </interfaces>

  <tests>
    <standards>
      Testing approach: Unit tests for color logic, component tests for rendering, accessibility tests for WCAG compliance.
      Focus on color coding correctness, accessibility (text alternatives, color contrast), and integration with progress displays.
      Test edge cases: accuracy = threshold, accuracy = threshold - 5%, accuracy = 0%, accuracy = 100%.
      Manual testing for visual appearance and accessibility with screen readers.
    </standards>
    <locations>
      Unit tests: Create test file for lib/progress-helpers.ts (e.g., lib/__tests__/progress-helpers.test.ts)
      Component tests: Test ProgressIndicator component rendering and accessibility
      Accessibility tests: Test with screen reader tools and color contrast checkers
      No formal test framework currently configured - focus on manual testing and code review
    </locations>
    <ideas>
      <test id="AC1">
        <description>Test color coding logic</description>
        <steps>1. Test accuracy 75% ≥ threshold 70% → green. 2. Test accuracy 68% (threshold - 2%) → yellow. 3. Test accuracy 65% &lt; (threshold - 5%) → red. 4. Verify threshold prop works correctly.</steps>
      </test>
      <test id="AC2">
        <description>Test green indicator</description>
        <steps>1. Render ProgressIndicator with accuracy 75% and threshold 70%. 2. Verify displays green color. 3. Verify aria-label includes "On track" or similar. 4. Verify aria-label includes accuracy percentage.</steps>
      </test>
      <test id="AC3">
        <description>Test yellow indicator</description>
        <steps>1. Render ProgressIndicator with accuracy 68% and threshold 70%. 2. Verify displays yellow color. 3. Verify aria-label includes "Attention needed" or similar. 4. Verify aria-label includes accuracy percentage.</steps>
      </test>
      <test id="AC4">
        <description>Test red indicator</description>
        <steps>1. Render ProgressIndicator with accuracy 65% and threshold 70%. 2. Verify displays red color. 3. Verify aria-label includes "Struggling" or similar. 4. Verify aria-label includes accuracy percentage.</steps>
      </test>
      <test id="AC5">
        <description>Test accessibility: color contrast</description>
        <steps>1. Test green indicator contrast meets WCAG AA (4.5:1). 2. Test yellow indicator contrast meets WCAG AA. 3. Test red indicator contrast meets WCAG AA. 4. Verify text alternatives are clearly visible.</steps>
      </test>
      <test id="AC5">
        <description>Test accessibility: screen reader</description>
        <steps>1. Test with screen reader tool. 2. Verify aria-labels are read correctly. 3. Verify status text is clear. 4. Verify accuracy percentage is announced.</steps>
      </test>
    </ideas>
  </tests>
</story-context>

