<story-context id="bmad/bmm/workflows/4-implementation/story-context" v="1.0">
  <metadata>
    <epicId>7</epicId>
    <storyId>7-4</storyId>
    <title>Parent Views Teacher Notes</title>
    <status>drafted</status>
    <generatedAt>2025-11-25</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/7-4-parent-views-teacher-notes.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>Parent</asA>
    <iWant>to view teacher notes about my child</iWant>
    <soThat>I can see teacher feedback</soThat>
    <tasks>
      <task>Design TeacherNote model (if not exists) - add to prisma/schema.prisma</task>
      <task>Create migration for TeacherNote model</task>
      <task>Create parent notes API endpoint (app/api/parent/notes/route.ts)</task>
      <task>Query notes for parent's children (via ParentStudent relationship)</task>
      <task>Create ParentNotes component (components/parent/ParentNotes.tsx)</task>
      <task>Display notes chronologically with date, teacher name, note content</task>
      <task>Add filtering/search functionality for notes</task>
      <task>Handle empty state (no notes available)</task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="AC1">
      <given>teacher has added notes</given>
      <when>I view the parent portal</when>
      <then>I can see teacher notes</then>
      <and>notes are organized by date</and>
      <and>notes are clearly displayed</and>
    </criterion>
    <criterion id="AC2">
      <given>teacher has added multiple notes</given>
      <when>I view teacher notes</when>
      <then>I see: Notes listed chronologically, Date and time of each note, Teacher name, Note content, Ability to filter or search notes</then>
    </criterion>
    <criterion id="AC3">
      <given>teacher has not added any notes</given>
      <when>I view teacher notes</when>
      <then>I see a message indicating no notes available</then>
      <and>the message is helpful and clear</and>
    </criterion>
    <criterion id="AC4">
      <given>I have multiple children</given>
      <when>I view teacher notes</when>
      <then>notes are filtered to show only notes for the selected child</then>
      <and>I can switch between children to see their respective notes</and>
    </criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/epics.md</path>
        <title>Epic Breakdown</title>
        <section>Epic 7: Parent Portal - Story 7.4</section>
        <snippet>As a Parent, I want to view teacher notes about my child, So that I can see teacher feedback. Teacher notes data model, notes display components, filtering/search functionality.</snippet>
      </doc>
      <doc>
        <path>docs/PRD.md</path>
        <title>Product Requirements Document</title>
        <section>FR-008: Parent Portal</section>
        <snippet>FR-008.4: Parents shall be able to view teacher notes about their children. Notes organized by date, filterable by child, searchable.</snippet>
      </doc>
      <doc>
        <path>docs/stories/7-1-parent-dashboard-progress-graphs.md</path>
        <title>Story 7.1: Parent Dashboard</title>
        <section>Learnings</section>
        <snippet>Parent dashboard patterns established. Parent API endpoint patterns established. Child selector patterns established.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>prisma/schema.prisma</path>
        <kind>database schema</kind>
        <symbol>User</symbol>
        <lines>20-42</lines>
        <reason>User model to reference. Add TeacherNote model with relations to User (teacher, student) for storing teacher notes.</reason>
      </artifact>
      <artifact>
        <path>prisma/schema.prisma</path>
        <kind>database schema</kind>
        <symbol>ParentStudent</symbol>
        <lines>44-56</lines>
        <reason>ParentStudent model for parent-child relationships. Use to filter notes for parent's children only.</reason>
      </artifact>
      <artifact>
        <path>app/parent/dashboard/page.tsx</path>
        <kind>page</kind>
        <symbol>ParentDashboardPage</symbol>
        <lines>1-50</lines>
        <reason>Parent dashboard page. Add ParentNotes component to display teacher notes section.</reason>
      </artifact>
    </code>
    <dependencies>
      <ecosystem name="node">
        <package name="next" version="^14.2.0" />
        <package name="react" version="^18.3.0" />
        <package name="react-dom" version="^18.3.0" />
        <package name="@prisma/client" version="^5.19.0" />
        <package name="prisma" version="^5.19.0" />
        <package name="zod" version="^3.23.8" />
        <package name="typescript" version="^5.5.0" />
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>Database model: TeacherNote model stores notes with teacherId, studentId, note content, timestamps</constraint>
    <constraint>Tenant isolation: Notes are isolated by teacherId and filtered by ParentStudent relationship - parents only see notes for their children</constraint>
    <constraint>API authorization: Use withRole('PARENT') helper to ensure only parents can access their children's notes</constraint>
    <constraint>Note organization: Notes displayed chronologically (newest first or oldest first, configurable)</constraint>
    <constraint>Filtering: Support filtering by child if parent has multiple children</constraint>
    <constraint>Search: Support searching notes by content if needed</constraint>
    <constraint>Component pattern: Follow existing component patterns from components/parent/ - use TypeScript, Tailwind CSS, proper prop types</constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>GET /api/parent/notes</name>
      <kind>REST endpoint</kind>
      <signature>GET /api/parent/notes?childId=string&amp;search=string
Response (200): {
  notes: [
    {
      id: string,
      childId: string,
      childName: string,
      teacherId: string,
      teacherName: string,
      note: string,
      createdAt: Date,
      updatedAt: Date
    }
  ]
}
Response (403): { error: "Access denied" }</signature>
      <path>app/api/parent/notes/route.ts</path>
    </interface>
    <interface>
      <name>TeacherNote Model (Prisma)</name>
      <kind>Database model</kind>
      <signature>model TeacherNote {
  id: String @id @default(cuid())
  teacherId: String
  studentId: String
  note: String
  createdAt: DateTime @default(now())
  updatedAt: DateTime @updatedAt
  teacher: User @relation(...)
  student: User @relation(...)
  @@index([studentId])
  @@index([createdAt])
}</signature>
      <path>prisma/schema.prisma</path>
    </interface>
  </interfaces>

  <tests>
    <standards>
      Testing approach: Integration tests for API endpoint, component tests for note display and filtering, tenant isolation tests.
      Focus on note retrieval correctness, tenant isolation, filtering/search functionality, and user experience.
      Test edge cases: no notes, multiple children, many notes, search functionality.
      Manual testing for visual appearance and note interactions.
    </standards>
    <locations>
      Integration tests: Test API endpoint via browser dev tools Network tab or Postman
      Component tests: Test ParentNotes component rendering and filtering
      No formal test framework currently configured - focus on manual testing and code review
    </locations>
    <ideas>
      <test id="AC1">
        <description>Test note display</description>
        <steps>1. Login as parent with child having teacher notes. 2. View parent portal. 3. Verify teacher notes display. 4. Verify notes organized by date. 5. Verify notes clearly displayed.</steps>
      </test>
      <test id="AC2">
        <description>Test note details</description>
        <steps>1. View teacher notes with multiple notes. 2. Verify notes listed chronologically. 3. Verify each note shows date, time, teacher name, note content. 4. Test filter/search functionality.</steps>
      </test>
      <test id="AC3">
        <description>Test empty state</description>
        <steps>1. View teacher notes with no notes. 2. Verify message displays indicating no notes available. 3. Verify message is helpful and clear.</steps>
      </test>
      <test id="AC4">
        <description>Test multiple children</description>
        <steps>1. Login as parent with multiple children. 2. View teacher notes. 3. Verify notes filtered to show only notes for selected child. 4. Switch between children. 5. Verify respective notes display.</steps>
      </test>
    </ideas>
  </tests>
</story-context>

