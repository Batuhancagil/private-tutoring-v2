<story-context id="bmad/bmm/workflows/4-implementation/story-context" v="1.0">
  <metadata>
    <epicId>7</epicId>
    <storyId>7-1</storyId>
    <title>Parent Dashboard &amp; Progress Graphs</title>
    <status>drafted</status>
    <generatedAt>2025-11-25</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/stories/7-1-parent-dashboard-progress-graphs.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>Parent</asA>
    <iWant>to see my child's progress in graphs</iWant>
    <soThat>I can understand how they're doing</soThat>
    <tasks>
      <task>Create parent progress API endpoint (app/api/parent/progress/route.ts)</task>
      <task>Query ProgressLog entries for parent's children (via ParentStudent relationship)</task>
      <task>Aggregate progress data by date (question counts, accuracy)</task>
      <task>Create parent dashboard page (app/parent/dashboard/page.tsx)</task>
      <task>Add child selector dropdown (if multiple children)</task>
      <task>Create ProgressGraphs component (components/parent/ProgressGraphs.tsx)</task>
      <task>Integrate charting library (recharts) for question count and accuracy trend graphs</task>
      <task>Ensure mobile-responsive layout and performance</task>
    </tasks>
  </story>

  <acceptanceCriteria>
    <criterion id="AC1">
      <given>I am logged in as a Parent</given>
      <when>I view my child's progress</when>
      <then>I see: Progress graphs (question counts, accuracy), Trend lines over time, Visual indicators, Mobile-optimized display</then>
    </criterion>
    <criterion id="AC2">
      <given>I have multiple children</given>
      <when>I view the parent dashboard</when>
      <then>I can select which child's progress to view</then>
      <and>graphs update to show that child's data</and>
    </criterion>
    <criterion id="AC3">
      <given>my child has logged questions</given>
      <when>I view progress graphs</when>
      <then>I see: Question count graph showing daily progress, Accuracy trend graph showing performance over time, Both graphs interactive and responsive, Data displayed clearly on mobile</then>
    </criterion>
    <criterion id="AC4">
      <given>my child has no logged questions yet</given>
      <when>I view the parent dashboard</when>
      <then>I see a message indicating no data available</then>
      <and>graphs show empty state with helpful message</and>
    </criterion>
  </acceptanceCriteria>

  <artifacts>
    <docs>
      <doc>
        <path>docs/epics.md</path>
        <title>Epic Breakdown</title>
        <section>Epic 7: Parent Portal - Story 7.1</section>
        <snippet>As a Parent, I want to see my child's progress in graphs, So that I can understand how they're doing. Parent dashboard, graph/chart components, data visualization, mobile optimization.</snippet>
      </doc>
      <doc>
        <path>docs/PRD.md</path>
        <title>Product Requirements Document</title>
        <section>FR-008: Parent Portal</section>
        <snippet>FR-008.1: Parents shall see their child's progress in graphs. Display question counts and accuracy trends over time, mobile-optimized.</snippet>
      </doc>
      <doc>
        <path>docs/architecture.md</path>
        <title>Architecture Document</title>
        <section>Mobile-First</section>
        <snippet>Parent portal is mobile-optimized. Use Tailwind CSS responsive utilities, mobile-first approach. Ensure graphs work on mobile devices.</snippet>
      </doc>
    </docs>
    <code>
      <artifact>
        <path>app/parent/dashboard/page.tsx</path>
        <kind>page</kind>
        <symbol>ParentDashboardPage</symbol>
        <lines>1-50</lines>
        <reason>Existing parent dashboard page structure. Update to include progress graphs and child selector.</reason>
      </artifact>
      <artifact>
        <path>prisma/schema.prisma</path>
        <kind>database schema</kind>
        <symbol>ParentStudent</symbol>
        <lines>44-56</lines>
        <reason>ParentStudent model for parent-child relationships. Use to query children for parent and filter ProgressLog entries.</reason>
      </artifact>
      <artifact>
        <path>prisma/schema.prisma</path>
        <kind>database schema</kind>
        <symbol>ProgressLog</symbol>
        <lines>121-140</lines>
        <reason>ProgressLog model with date, rightCount, wrongCount, emptyCount, bonusCount fields. Aggregate by date for graph data.</reason>
      </artifact>
      <artifact>
        <path>lib/progress-calculator.ts</path>
        <kind>service</kind>
        <symbol>calculateDualMetrics</symbol>
        <lines>1-200</lines>
        <reason>Progress calculation service. May need to extend for parent-specific queries aggregating by date for graph data.</reason>
      </artifact>
    </code>
    <dependencies>
      <ecosystem name="node">
        <package name="next" version="^14.2.0" />
        <package name="react" version="^18.3.0" />
        <package name="react-dom" version="^18.3.0" />
        <package name="@prisma/client" version="^5.19.0" />
        <package name="prisma" version="^5.19.0" />
        <package name="zod" version="^3.23.8" />
        <package name="typescript" version="^5.5.0" />
        <package name="recharts" version="^2.10.0" />
      </ecosystem>
    </dependencies>
  </artifacts>

  <constraints>
    <constraint>Tenant isolation: Parent data is isolated by ParentStudent relationship - ensure API only returns progress for parent's assigned children</constraint>
    <constraint>API authorization: Use withRole('PARENT') helper to ensure only parents can access their children's progress</constraint>
    <constraint>Chart library: Use recharts for React (lightweight, mobile-friendly) per architecture.md</constraint>
    <constraint>Mobile-first: Parent portal is mobile-optimized - ensure graphs work on mobile devices</constraint>
    <constraint>Performance: Graph data aggregation should complete in &lt; 500ms per architecture.md</constraint>
    <constraint>Data aggregation: Aggregate ProgressLog entries by date, calculate daily totals and accuracy</constraint>
    <constraint>Component pattern: Follow existing component patterns from components/parent/ - use TypeScript, Tailwind CSS, proper prop types</constraint>
  </constraints>

  <interfaces>
    <interface>
      <name>GET /api/parent/progress</name>
      <kind>REST endpoint</kind>
      <signature>GET /api/parent/progress?childId=string
Response (200): {
  childId: string,
  childName: string,
  graphs: {
    questionCounts: [{ date: string, total: number }],
    accuracy: [{ date: string, accuracy: number }]
  }
}
Response (403): { error: "Access denied" }</signature>
      <path>app/api/parent/progress/route.ts</path>
    </interface>
    <interface>
      <name>ProgressGraphs Component</name>
      <kind>React component</kind>
      <signature>interface ProgressGraphsProps {
  questionCounts: [{ date: string, total: number }];
  accuracy: [{ date: string, accuracy: number }];
}

export function ProgressGraphs({ questionCounts, accuracy }: ProgressGraphsProps): JSX.Element
Displays question count and accuracy trend graphs using recharts library.</signature>
      <path>components/parent/ProgressGraphs.tsx</path>
    </interface>
  </interfaces>

  <tests>
    <standards>
      Testing approach: Integration tests for API endpoint, component tests for graph rendering, mobile viewport tests, accessibility tests.
      Focus on data accuracy, mobile responsiveness, tenant isolation, and user experience.
      Test edge cases: no logged data, multiple children, slow network, different date ranges.
      Manual testing for visual appearance and mobile responsiveness.
    </standards>
    <locations>
      Integration tests: Test API endpoint via browser dev tools Network tab or Postman
      Component tests: Test ProgressGraphs component rendering
      Mobile viewport tests: Test graphs on mobile viewport sizes
      No formal test framework currently configured - focus on manual testing and code review
    </locations>
    <ideas>
      <test id="AC1">
        <description>Test parent dashboard displays graphs</description>
        <steps>1. Login as parent. 2. View parent dashboard. 3. Verify displays progress graphs (question counts, accuracy). 4. Verify trend lines over time. 5. Verify visual indicators. 6. Verify mobile-optimized display.</steps>
      </test>
      <test id="AC2">
        <description>Test multiple children selector</description>
        <steps>1. Login as parent with multiple children. 2. View dashboard. 3. Verify child selector dropdown displays. 4. Select different child. 5. Verify graphs update to show that child's data.</steps>
      </test>
      <test id="AC3">
        <description>Test graph display</description>
        <steps>1. View progress graphs for child with logged questions. 2. Verify question count graph shows daily progress. 3. Verify accuracy trend graph shows performance over time. 4. Verify graphs are interactive and responsive. 5. Verify data displayed clearly on mobile.</steps>
      </test>
      <test id="AC4">
        <description>Test empty state</description>
        <steps>1. View dashboard for child with no logged questions. 2. Verify message displays indicating no data available. 3. Verify graphs show empty state with helpful message.</steps>
      </test>
    </ideas>
  </tests>
</story-context>

